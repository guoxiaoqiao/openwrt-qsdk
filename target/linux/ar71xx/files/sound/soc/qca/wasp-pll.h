/*
 * wasp-pll.h -- Audio PLL management for DB12x board ref design (and relatives)
 *
 * Copyright (c) 2012 Atheros Communications Inc.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#define ath_reg_rd(_phys)	(*(volatile ath_reg_t *)KSEG1ADDR(_phys))

#define ath_reg_wr_nf(_phys, _val) \
	((*(volatile ath_reg_t *)KSEG1ADDR(_phys)) = (_val))

#define ath_reg_wr(_phys, _val) do {	\
	ath_reg_wr_nf(_phys, _val);	\
	ath_reg_rd(_phys);		\
} while(0)

#define ath_reg_rmw_set(_reg, _mask)	do {			\
	ath_reg_wr((_reg), (ath_reg_rd((_reg)) | (_mask)));	\
	ath_reg_rd((_reg));					\
} while(0)

#define ath_reg_rmw_clear(_reg, _mask) do {			\
	ath_reg_wr((_reg), (ath_reg_rd((_reg)) & ~(_mask)));	\
	ath_reg_rd((_reg));					\
} while(0)

#define ATH_AUDIO_PLL_CFG_PWR_DWN   (1ul << 5)

#define ATH_AUDIO_DPLL2             0xb8116204
#define ATH_AUDIO_DPLL3             0xb8116208

#define ATH_AUDIO_DPLL2_PATH_GAIN(x)    ((0xf&x)  << 26)
#define ATH_AUDIO_DPLL2_PROP_GAIN(x)    ((0x7f&x) << 19)
#define ATH_AUDIO_DPLL3_PHASE_SHIFT(x)  ((0x7f&x) << 23)

#define ATH_AUD_DPLL2_RANGE_MSB			31
#define ATH_AUD_DPLL2_RANGE_LSB			31
#define ATH_AUD_DPLL2_RANGE_MASK		0x80000000
#define ATH_AUD_DPLL2_RANGE_GET(x)		(((x) & ATH_AUD_DPLL2_RANGE_MASK) >> ATH_AUD_DPLL2_RANGE_LSB)
#define ATH_AUD_DPLL2_RANGE_SET(x)		(((x) << ATH_AUD_DPLL2_RANGE_LSB) & ATH_AUD_DPLL2_RANGE_MASK)
#define ATH_AUD_DPLL2_RANGE_RESET		0x0 // 0
#define ATH_AUD_DPLL2_LOCAL_PLL_MSB		30
#define ATH_AUD_DPLL2_LOCAL_PLL_LSB		30
#define ATH_AUD_DPLL2_LOCAL_PLL_MASK		0x40000000
#define ATH_AUD_DPLL2_LOCAL_PLL_GET(x)		(((x) & ATH_AUD_DPLL2_LOCAL_PLL_MASK) >> ATH_AUD_DPLL2_LOCAL_PLL_LSB)
#define ATH_AUD_DPLL2_LOCAL_PLL_SET(x)		(((x) << ATH_AUD_DPLL2_LOCAL_PLL_LSB) & ATH_AUD_DPLL2_LOCAL_PLL_MASK)
#define ATH_AUD_DPLL2_LOCAL_PLL_RESET		0x0 // 0
#define ATH_AUD_DPLL2_KI_MSB			29
#define ATH_AUD_DPLL2_KI_LSB			26
#define ATH_AUD_DPLL2_KI_MASK			0x3c000000
#define ATH_AUD_DPLL2_KI_GET(x)			(((x) & ATH_AUD_DPLL2_KI_MASK) >> ATH_AUD_DPLL2_KI_LSB)
#define ATH_AUD_DPLL2_KI_SET(x)			(((x) << ATH_AUD_DPLL2_KI_LSB) & ATH_AUD_DPLL2_KI_MASK)
#define ATH_AUD_DPLL2_KI_RESET			0x6 // 6
#define ATH_AUD_DPLL2_KD_MSB			25
#define ATH_AUD_DPLL2_KD_LSB			19
#define ATH_AUD_DPLL2_KD_MASK			0x03f80000
#define ATH_AUD_DPLL2_KD_GET(x)			(((x) & ATH_AUD_DPLL2_KD_MASK) >> ATH_AUD_DPLL2_KD_LSB)
#define ATH_AUD_DPLL2_KD_SET(x)			(((x) << ATH_AUD_DPLL2_KD_LSB) & ATH_AUD_DPLL2_KD_MASK)
#define ATH_AUD_DPLL2_KD_RESET			0x7f // 127
#define ATH_AUD_DPLL2_EN_NEGTRIG_MSB		18
#define ATH_AUD_DPLL2_EN_NEGTRIG_LSB		18
#define ATH_AUD_DPLL2_EN_NEGTRIG_MASK		0x00040000
#define ATH_AUD_DPLL2_EN_NEGTRIG_GET(x)		(((x) & ATH_AUD_DPLL2_EN_NEGTRIG_MASK) >> ATH_AUD_DPLL2_EN_NEGTRIG_LSB)
#define ATH_AUD_DPLL2_EN_NEGTRIG_SET(x)		(((x) << ATH_AUD_DPLL2_EN_NEGTRIG_LSB) & ATH_AUD_DPLL2_EN_NEGTRIG_MASK)
#define ATH_AUD_DPLL2_EN_NEGTRIG_RESET		0x0 // 0
#define ATH_AUD_DPLL2_SEL_1SDM_MSB		17
#define ATH_AUD_DPLL2_SEL_1SDM_LSB		17
#define ATH_AUD_DPLL2_SEL_1SDM_MASK		0x00020000
#define ATH_AUD_DPLL2_SEL_1SDM_GET(x)		(((x) & ATH_AUD_DPLL2_SEL_1SDM_MASK) >> ATH_AUD_DPLL2_SEL_1SDM_LSB)
#define ATH_AUD_DPLL2_SEL_1SDM_SET(x)		(((x) << ATH_AUD_DPLL2_SEL_1SDM_LSB) & ATH_AUD_DPLL2_SEL_1SDM_MASK)
#define ATH_AUD_DPLL2_SEL_1SDM_RESET		0x0 // 0
#define ATH_AUD_DPLL2_PLL_PWD_MSB		16
#define ATH_AUD_DPLL2_PLL_PWD_LSB		16
#define ATH_AUD_DPLL2_PLL_PWD_MASK		0x00010000
#define ATH_AUD_DPLL2_PLL_PWD_GET(x)		(((x) & ATH_AUD_DPLL2_PLL_PWD_MASK) >> ATH_AUD_DPLL2_PLL_PWD_LSB)
#define ATH_AUD_DPLL2_PLL_PWD_SET(x)		(((x) << ATH_AUD_DPLL2_PLL_PWD_LSB) & ATH_AUD_DPLL2_PLL_PWD_MASK)
#define ATH_AUD_DPLL2_PLL_PWD_RESET		0x1 // 1
#define ATH_AUD_DPLL2_OUTDIV_MSB		15
#define ATH_AUD_DPLL2_OUTDIV_LSB		13
#define ATH_AUD_DPLL2_OUTDIV_MASK		0x0000e000
#define ATH_AUD_DPLL2_OUTDIV_GET(x)		(((x) & ATH_AUD_DPLL2_OUTDIV_MASK) >> ATH_AUD_DPLL2_OUTDIV_LSB)
#define ATH_AUD_DPLL2_OUTDIV_SET(x)		(((x) << ATH_AUD_DPLL2_OUTDIV_LSB) & ATH_AUD_DPLL2_OUTDIV_MASK)
#define ATH_AUD_DPLL2_OUTDIV_RESET		0x0 // 0
#define ATH_AUD_DPLL2_DELTA_MSB			12
#define ATH_AUD_DPLL2_DELTA_LSB			7
#define ATH_AUD_DPLL2_DELTA_MASK		0x00001f80
#define ATH_AUD_DPLL2_DELTA_GET(x)		(((x) & ATH_AUD_DPLL2_DELTA_MASK) >> ATH_AUD_DPLL2_DELTA_LSB)
#define ATH_AUD_DPLL2_DELTA_SET(x)		(((x) << ATH_AUD_DPLL2_DELTA_LSB) & ATH_AUD_DPLL2_DELTA_MASK)
#define ATH_AUD_DPLL2_DELTA_RESET		0x1e // 30
#define ATH_AUD_DPLL2_SPARE_MSB			6
#define ATH_AUD_DPLL2_SPARE_LSB			0
#define ATH_AUD_DPLL2_SPARE_MASK		0x0000007f
#define ATH_AUD_DPLL2_SPARE_GET(x)		(((x) & ATH_AUD_DPLL2_SPARE_MASK) >> ATH_AUD_DPLL2_SPARE_LSB)
#define ATH_AUD_DPLL2_SPARE_SET(x)		(((x) << ATH_AUD_DPLL2_SPARE_LSB) & ATH_AUD_DPLL2_SPARE_MASK)
#define ATH_AUD_DPLL2_SPARE_RESET		0x0 // 0
#define ATH_AUD_DPLL2_ADDRESS			0x18116204

#define ATH_AUD_DPLL3_MEAS_AT_TXON_MSB		31
#define ATH_AUD_DPLL3_MEAS_AT_TXON_LSB		31
#define ATH_AUD_DPLL3_MEAS_AT_TXON_MASK		0x80000000
#define ATH_AUD_DPLL3_MEAS_AT_TXON_GET(x)	(((x) & ATH_AUD_DPLL3_MEAS_AT_TXON_MASK) >> ATH_AUD_DPLL3_MEAS_AT_TXON_LSB)
#define ATH_AUD_DPLL3_MEAS_AT_TXON_SET(x)	(((x) << ATH_AUD_DPLL3_MEAS_AT_TXON_LSB) & ATH_AUD_DPLL3_MEAS_AT_TXON_MASK)
#define ATH_AUD_DPLL3_MEAS_AT_TXON_RESET	0x0 // 0
#define ATH_AUD_DPLL3_DO_MEAS_MSB		30
#define ATH_AUD_DPLL3_DO_MEAS_LSB		30
#define ATH_AUD_DPLL3_DO_MEAS_MASK		0x40000000
#define ATH_AUD_DPLL3_DO_MEAS_GET(x)		(((x) & ATH_AUD_DPLL3_DO_MEAS_MASK) >> ATH_AUD_DPLL3_DO_MEAS_LSB)
#define ATH_AUD_DPLL3_DO_MEAS_SET(x)		(((x) << ATH_AUD_DPLL3_DO_MEAS_LSB) & ATH_AUD_DPLL3_DO_MEAS_MASK)
#define ATH_AUD_DPLL3_DO_MEAS_RESET		0x0 // 0
#define ATH_AUD_DPLL3_PHASE_SHIFT_MSB		29
#define ATH_AUD_DPLL3_PHASE_SHIFT_LSB		23
#define ATH_AUD_DPLL3_PHASE_SHIFT_MASK		0x3f800000
#define ATH_AUD_DPLL3_PHASE_SHIFT_GET(x)	(((x) & ATH_AUD_DPLL3_PHASE_SHIFT_MASK) >> ATH_AUD_DPLL3_PHASE_SHIFT_LSB)
#define ATH_AUD_DPLL3_PHASE_SHIFT_SET(x)	(((x) << ATH_AUD_DPLL3_PHASE_SHIFT_LSB) & ATH_AUD_DPLL3_PHASE_SHIFT_MASK)
#define ATH_AUD_DPLL3_PHASE_SHIFT_RESET		0x0 // 0
#define ATH_AUD_DPLL3_SQSUM_DVC_MSB		22
#define ATH_AUD_DPLL3_SQSUM_DVC_LSB		3
#define ATH_AUD_DPLL3_SQSUM_DVC_MASK		0x007ffff8
#define ATH_AUD_DPLL3_SQSUM_DVC_GET(x)		(((x) & ATH_AUD_DPLL3_SQSUM_DVC_MASK) >> ATH_AUD_DPLL3_SQSUM_DVC_LSB)
#define ATH_AUD_DPLL3_SQSUM_DVC_SET(x)		(((x) << ATH_AUD_DPLL3_SQSUM_DVC_LSB) & ATH_AUD_DPLL3_SQSUM_DVC_MASK)
#define ATH_AUD_DPLL3_SQSUM_DVC_RESET		0x0 // 0
#define ATH_AUD_DPLL3_SPARE_MSB			2
#define ATH_AUD_DPLL3_SPARE_LSB			0
#define ATH_AUD_DPLL3_SPARE_MASK		0x00000007
#define ATH_AUD_DPLL3_SPARE_GET(x)		(((x) & ATH_AUD_DPLL3_SPARE_MASK) >> ATH_AUD_DPLL3_SPARE_LSB)
#define ATH_AUD_DPLL3_SPARE_SET(x)		(((x) << ATH_AUD_DPLL3_SPARE_LSB) & ATH_AUD_DPLL3_SPARE_MASK)
#define ATH_AUD_DPLL3_SPARE_RESET		0x0 // 0
#define ATH_AUD_DPLL3_ADDRESS			0x18116208

#define ATH_AUD_DPLL4_MEAN_DVC_MSB		31
#define ATH_AUD_DPLL4_MEAN_DVC_LSB		21
#define ATH_AUD_DPLL4_MEAN_DVC_MASK		0xffe00000
#define ATH_AUD_DPLL4_MEAN_DVC_GET(x)		(((x) & ATH_AUD_DPLL4_MEAN_DVC_MASK) >> ATH_AUD_DPLL4_MEAN_DVC_LSB)
#define ATH_AUD_DPLL4_MEAN_DVC_SET(x)		(((x) << ATH_AUD_DPLL4_MEAN_DVC_LSB) & ATH_AUD_DPLL4_MEAN_DVC_MASK)
#define ATH_AUD_DPLL4_MEAN_DVC_RESET		0x0 // 0
#define ATH_AUD_DPLL4_VC_MEAS0_MSB		20
#define ATH_AUD_DPLL4_VC_MEAS0_LSB		4
#define ATH_AUD_DPLL4_VC_MEAS0_MASK		0x001ffff0
#define ATH_AUD_DPLL4_VC_MEAS0_GET(x)		(((x) & ATH_AUD_DPLL4_VC_MEAS0_MASK) >> ATH_AUD_DPLL4_VC_MEAS0_LSB)
#define ATH_AUD_DPLL4_VC_MEAS0_SET(x)		(((x) << ATH_AUD_DPLL4_VC_MEAS0_LSB) & ATH_AUD_DPLL4_VC_MEAS0_MASK)
#define ATH_AUD_DPLL4_VC_MEAS0_RESET		0x0 // 0
#define ATH_AUD_DPLL4_MEAS_DONE_MSB		3
#define ATH_AUD_DPLL4_MEAS_DONE_LSB		3
#define ATH_AUD_DPLL4_MEAS_DONE_MASK		0x00000008
#define ATH_AUD_DPLL4_MEAS_DONE_GET(x)		(((x) & ATH_AUD_DPLL4_MEAS_DONE_MASK) >> ATH_AUD_DPLL4_MEAS_DONE_LSB)
#define ATH_AUD_DPLL4_MEAS_DONE_SET(x)		(((x) << ATH_AUD_DPLL4_MEAS_DONE_LSB) & ATH_AUD_DPLL4_MEAS_DONE_MASK)
#define ATH_AUD_DPLL4_MEAS_DONE_RESET		0x0 // 0
#define ATH_AUD_DPLL4_SPARE_MSB			2
#define ATH_AUD_DPLL4_SPARE_LSB			0
#define ATH_AUD_DPLL4_SPARE_MASK		0x00000007
#define ATH_AUD_DPLL4_SPARE_GET(x)		(((x) & ATH_AUD_DPLL4_SPARE_MASK) >> ATH_AUD_DPLL4_SPARE_LSB)
#define ATH_AUD_DPLL4_SPARE_SET(x)		(((x) << ATH_AUD_DPLL4_SPARE_LSB) & ATH_AUD_DPLL4_SPARE_MASK)
#define ATH_AUD_DPLL4_SPARE_RESET		0x0 // 0
#define ATH_AUD_DPLL4_ADDRESS			0x1811620c

#define ATH_AUD_DPLL3_KD_25			0x3d
#define ATH_AUD_DPLL3_KD_40			0x32

#define ATH_AUD_DPLL3_KI_25			0x4
#define ATH_AUD_DPLL3_KI_40			0x4

void wasp_i2s_clk_set(u32 frac, u32 pll);
void wasp_i2s_dpll(u32 kd, u32 ki);
